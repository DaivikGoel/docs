---
title: 'Error Handling'
description: 'Understanding and handling API errors'
---

## Overview

The Shor API uses conventional HTTP response codes to indicate the success or failure of an API request. In general:

- `2xx` codes indicate success
- `4xx` codes indicate an error with the request
- `5xx` codes indicate an error with our servers

## Error Response Format

All errors return a consistent JSON structure:

```json
{
  "error": {
    "type": "validation_error",
    "message": "Invalid request parameters",
    "code": "INVALID_PARAMS",
    "details": {
      "field": "amount",
      "issue": "Must be a positive number"
    }
  },
  "request_id": "req_abc123xyz"
}
```

## HTTP Status Codes

### Success Codes (2xx)

| Code | Meaning | Description |
|------|---------|-------------|
| `200` | OK | Request succeeded |
| `201` | Created | Resource created successfully |
| `204` | No Content | Request succeeded with no response body |

### Client Error Codes (4xx)

| Code | Meaning | Description |
|------|---------|-------------|
| `400` | Bad Request | Invalid request format or parameters |
| `401` | Unauthorized | Missing or invalid authentication |
| `403` | Forbidden | Valid auth but insufficient permissions |
| `404` | Not Found | Requested resource doesn't exist |
| `409` | Conflict | Request conflicts with current state |
| `422` | Unprocessable Entity | Valid format but semantic errors |
| `429` | Too Many Requests | Rate limit exceeded |

### Server Error Codes (5xx)

| Code | Meaning | Description |
|------|---------|-------------|
| `500` | Internal Server Error | Unexpected server error |
| `502` | Bad Gateway | Invalid response from upstream |
| `503` | Service Unavailable | Temporary maintenance or overload |
| `504` | Gateway Timeout | Upstream request timeout |

## Error Types

### Authentication Errors

```json
{
  "error": {
    "type": "authentication_error",
    "message": "Invalid API key provided",
    "code": "INVALID_API_KEY"
  }
}
```

**Common Causes:**
- Missing API key
- Malformed API key
- Revoked API key
- Wrong environment (test vs live)

### Validation Errors

```json
{
  "error": {
    "type": "validation_error",
    "message": "Request validation failed",
    "code": "VALIDATION_FAILED",
    "details": {
      "errors": [
        {
          "field": "amount",
          "message": "Must be between 10.00 and 5000.00"
        },
        {
          "field": "title",
          "message": "Required field missing"
        }
      ]
    }
  }
}
```

**Common Causes:**
- Missing required fields
- Invalid field formats
- Values outside allowed ranges
- Invalid field combinations

### Resource Errors

```json
{
  "error": {
    "type": "resource_error",
    "message": "Payment link not found",
    "code": "RESOURCE_NOT_FOUND",
    "resource_type": "payment_link",
    "resource_id": "link_abc123"
  }
}
```

**Common Causes:**
- Invalid resource ID
- Resource deleted
- Resource belongs to different merchant
- Resource in wrong state

### Rate Limit Errors

```json
{
  "error": {
    "type": "rate_limit_error",
    "message": "API rate limit exceeded",
    "code": "RATE_LIMIT_EXCEEDED",
    "retry_after": 3600,
    "limit": 1000,
    "remaining": 0,
    "reset": 1642098000
  }
}
```

**Headers Included:**
```
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1642098000
Retry-After: 3600
```

### Business Logic Errors

```json
{
  "error": {
    "type": "business_error",
    "message": "Payment already processed",
    "code": "PAYMENT_ALREADY_PROCESSED",
    "transaction_id": "txn_xyz789"
  }
}
```

**Common Scenarios:**
- Duplicate payment attempts
- Invalid state transitions
- Business rule violations
- Compliance restrictions

## Error Codes Reference

### Common Error Codes

| Code | Description | Resolution |
|------|-------------|------------|
| `INVALID_API_KEY` | API key is invalid or revoked | Check API key in dashboard |
| `INSUFFICIENT_PERMISSIONS` | API key lacks required permissions | Update key permissions |
| `VALIDATION_FAILED` | Request validation failed | Check request parameters |
| `RESOURCE_NOT_FOUND` | Requested resource doesn't exist | Verify resource ID |
| `DUPLICATE_REQUEST` | Request already processed | Check for idempotency |
| `PAYMENT_LIMIT_EXCEEDED` | Payment exceeds allowed limits | Reduce amount or contact support |
| `INVALID_STATE` | Operation not allowed in current state | Check resource state |
| `RATE_LIMIT_EXCEEDED` | Too many requests | Implement backoff strategy |

## Handling Errors

### Best Practices

<AccordionGroup>
  <Accordion title="Implement Retry Logic">
    ```javascript
    async function apiRequestWithRetry(url, options, maxRetries = 3) {
      for (let i = 0; i < maxRetries; i++) {
        try {
          const response = await fetch(url, options);
          
          if (response.status === 429) {
            const retryAfter = response.headers.get('Retry-After') || 60;
            await new Promise(resolve => setTimeout(resolve, retryAfter * 1000));
            continue;
          }
          
          if (!response.ok) {
            const error = await response.json();
            throw new ApiError(error);
          }
          
          return await response.json();
        } catch (error) {
          if (i === maxRetries - 1) throw error;
          await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));
        }
      }
    }
    ```
  </Accordion>
  
  <Accordion title="Parse Error Details">
    ```javascript
    function handleApiError(error) {
      switch (error.error.type) {
        case 'validation_error':
          // Show field-specific errors to user
          error.error.details.errors.forEach(err => {
            showFieldError(err.field, err.message);
          });
          break;
          
        case 'authentication_error':
          // Redirect to login or refresh token
          redirectToAuth();
          break;
          
        case 'rate_limit_error':
          // Implement exponential backoff
          scheduleRetry(error.error.retry_after);
          break;
          
        default:
          // Show generic error message
          showError(error.error.message);
      }
    }
    ```
  </Accordion>
  
  <Accordion title="Log Errors Properly">
    ```javascript
    function logApiError(error, context) {
      console.error('API Error:', {
        request_id: error.request_id,
        type: error.error.type,
        code: error.error.code,
        message: error.error.message,
        context: context,
        timestamp: new Date().toISOString()
      });
      
      // Send to error tracking service
      errorTracker.captureException(error, {
        tags: {
          api_error: true,
          error_type: error.error.type
        },
        extra: context
      });
    }
    ```
  </Accordion>
</AccordionGroup>

### Retry Strategy

Implement exponential backoff for transient errors:

```javascript
const retryableErrors = [429, 500, 502, 503, 504];

async function exponentialBackoff(fn, maxRetries = 5) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      const isRetryable = retryableErrors.includes(error.status);
      const isLastAttempt = i === maxRetries - 1;
      
      if (!isRetryable || isLastAttempt) {
        throw error;
      }
      
      const delay = Math.min(1000 * Math.pow(2, i), 30000);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
}
```

## Idempotency

### Preventing Duplicate Requests

Include an idempotency key for POST requests:

```bash
curl -X POST https://api.shorpay.com/api/v1/merchant/payment-links/create \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Idempotency-Key: unique-request-id-123" \
  -d '{...}'
```

Response includes idempotency information:
```json
{
  "data": {...},
  "idempotent_replayed": false
}
```

### Idempotency Errors

```json
{
  "error": {
    "type": "idempotency_error",
    "message": "Request with this idempotency key is already being processed",
    "code": "IDEMPOTENCY_KEY_IN_USE"
  }
}
```

## Webhook Errors

### Webhook Delivery Failures

When webhook delivery fails, we'll retry with exponential backoff:

1. Initial attempt: Immediate
2. First retry: 10 seconds
3. Second retry: 1 minute
4. Final retry: 10 minutes

### Handling Webhook Errors

Always respond with 2xx status to acknowledge receipt:

```javascript
app.post('/webhook', (req, res) => {
  // Acknowledge receipt immediately
  res.status(200).send('OK');
  
  // Process asynchronously
  processWebhookAsync(req.body).catch(error => {
    console.error('Webhook processing error:', error);
    // Handle error without affecting response
  });
});
```

## Testing Error Handling

### Trigger Test Errors

Use these test API keys to trigger specific errors:

| Test Key | Triggers |
|----------|----------|
| `sk_test_invalid` | Authentication error |
| `sk_test_forbidden` | Permission error |
| `sk_test_ratelimit` | Rate limit error |
| `sk_test_server_error` | 500 server error |

### Error Simulation Headers

Include headers to simulate errors in sandbox:

```bash
X-Shor-Test-Error: validation_error
X-Shor-Test-Error-Code: INVALID_AMOUNT
```

## Common Solutions

### Quick Fixes

<FAQ>
  <FAQItem question="Getting 401 Unauthorized">
    - Verify API key is correct
    - Check Authorization header format
    - Ensure using correct environment
    - Regenerate key if needed
  </FAQItem>
  
  <FAQItem question="Getting 429 Rate Limited">
    - Implement exponential backoff
    - Check rate limit headers
    - Reduce request frequency
    - Consider upgrading plan
  </FAQItem>
  
  <FAQItem question="Getting 422 Validation Error">
    - Read error details carefully
    - Check required fields
    - Verify data formats
    - Test with minimal payload
  </FAQItem>
</FAQ>

## Support

If you encounter persistent errors:

1. Note the `request_id` from error response
2. Check our [status page](https://status.shorpay.com)
3. Contact api-support@shorpay.com with details

Include in your support request:
- Request ID
- Error response
- Request details (method, endpoint, headers)
- Timestamp

## Next Steps

<CardGroup cols={2}>
  <Card title="API Reference" icon="book" href="/api-reference/payment-links/create">
    Explore API endpoints
  </Card>
  <Card title="Webhooks" icon="webhook" href="/api-reference/transactions/webhook">
    Set up webhook handling
  </Card>
</CardGroup>